<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TamasGem Studio ‚Äî AI</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#fff;
      --card:#fff;
      --text:#0b0b0c;
      --muted:#5f646b;
      --border:#ececec;
      --gold:#D4AF37;
      --gold-soft:#f5e6a2;
      --gold-dark:#b88900;
      --shadow: 0 10px 28px rgba(212,175,55,.08), 0 6px 16px rgba(0,0,0,.04);
    }
    .dark{
      --bg:#0b0c0f;
      --card:#111319;
      --text:#eaeef6;
      --muted:#9aa3ad;
      --border:#1e232b;
      --shadow: 0 10px 28px rgba(0,0,0,.6), 0 6px 16px rgba(0,0,0,.4);
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
    a{text-decoration:none;color:inherit}

    header{
      position:sticky;top:0;z-index:10;
      background:linear-gradient(#fffef6,var(--bg));
      border-bottom:1px solid var(--border);
      backdrop-filter:saturate(140%) blur(6px);
    }
    .dark header{background:linear-gradient(#0c0d12,var(--bg))}
    .container{max-width:980px;margin:0 auto;padding:14px 16px;display:flex;align-items:center;gap:12px;justify-content:space-between}
    .brand{display:flex;align-items:center;gap:10px}
    .brand img{height:28px;width:auto;filter:drop-shadow(0 0 6px rgba(212,175,55,.35))}
    .top-actions{display:flex;align-items:center;gap:10px}
    .btn{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 12px;border-radius:12px;border:1px solid var(--border);
      background:var(--card);color:var(--text);font-weight:600;font-size:13px;
      box-shadow:var(--shadow);cursor:pointer;transition:.2s ease;
    }
    .btn:hover{transform:translateY(-1px)}
    .btn.gold{
      border-color:rgba(212,175,55,.35);
      background:linear-gradient(90deg,#fff7d4,#f3e1a1);color:#7a5b0e;
    }

    /* a chat NEM fix magass√°g√∫: az oldal n≈ë √©s g√∂rgethet≈ë */
    main{max-width:980px;margin:18px auto;padding:0 16px}
    .panel{
      background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow);
      padding:14px;
    }

    /* fels≈ë eszk√∂zt√°r */
    .toolbar{display:flex;flex-wrap:wrap;gap:10px;align-items:center;margin-bottom:12px}
    .group{display:flex;align-items:center;gap:8px;padding:8px;border:1px solid var(--border);border-radius:12px;background:var(--bg)}
    label{font-size:12px;color:var(--muted)}
    select, input[type="range"]{
      appearance:none;border:1px solid var(--border);background:var(--card);color:var(--text);
      padding:6px 8px;border-radius:8px;outline:none;font-size:13px;
    }
    input[type="range"]{width:140px}

    /* √ºzenetek ‚Äì nincs bels≈ë scroll! */
    .messages{display:flex;flex-direction:column;gap:12px}
    .msg{
      max-width:78%;padding:12px 14px;border:1px solid var(--border);border-radius:14px;line-height:1.5;background:var(--bg);
      position:relative;
    }
    .msg.assistant{align-self:flex-start;background:linear-gradient(180deg,#fffef8,var(--bg));border-color:#f1e6bf}
    .dark .msg.assistant{background:linear-gradient(180deg,#14161c,var(--bg));border-color:#2a2f39}
    .msg.user{align-self:flex-end}
    .meta{margin-top:6px;font-size:11px;color:var(--muted)}
    .actions{
      position:absolute;top:8px;right:8px;display:flex;gap:6px;opacity:.0;transition:.2s;pointer-events:none;
    }
    .msg:hover .actions{opacity:1;pointer-events:auto}
    .icon-btn{
      width:28px;height:28px;border-radius:8px;border:1px solid var(--border);background:var(--card);
      display:inline-flex;align-items:center;justify-content:center;cursor:pointer;font-size:12px;
    }

    /* input s√°v ‚Äì automatikus magass√°g, Enter=send */
    .composer{margin-top:12px;display:flex;gap:10px;align-items:flex-end}
    .field{
      flex:1;display:flex;align-items:flex-end;gap:8px;border:1px solid var(--border);border-radius:14px;background:var(--bg);padding:10px 12px;
    }
    textarea{
      flex:1;border:0;outline:0;background:transparent;color:var(--text);resize:none;min-height:44px;max-height:240px;font-size:15px;line-height:1.5;
    }

    .hint{margin-top:6px;font-size:12px;color:var(--muted)}
    .spacer{height:24px}

    /* hidden file input */
    #importFile{display:none}
  </style>
</head>
<body>
  <header>
    <div class="container">
      <a class="brand" href="index.html" title="Vissza">
        <img src="logo.png" alt="TamasGem Studio" />
        <strong>TamasGem Studio ‚Äî AI</strong>
      </a>
      <div class="top-actions">
        <button class="btn" id="themeBtn" title="Dark / Light m√≥d v√°lt√°s">üåô</button>
        <button class="btn" id="exportBtn" title="Export .txt">‚¨áÔ∏è Export</button>
        <label class="btn" for="importFile" title="Import .json">‚¨ÜÔ∏è Import</label>
        <input id="importFile" type="file" accept="application/json" />
        <button class="btn" id="clearBtn" title="T√∂rl√©s (chat √ºr√≠t√©se)">üóëÔ∏è Clear</button>
      </div>
    </div>
  </header>

  <main>
    <section class="panel">
      <!-- fels≈ë eszk√∂zt√°r (UI, k√©s≈ëbb k√∂tj√ºk API-hoz) -->
      <div class="toolbar">
        <div class="group">
          <label for="model">Model</label>
          <select id="model">
            <option value="gpt-5">GPT-5</option>
            <option value="gpt-4.1">GPT-4.1</option>
            <option value="claude">Claude</option>
          </select>
        </div>
        <div class="group">
          <label for="temp">Temperature</label>
          <input id="temp" type="range" min="0" max="2" step="0.1" value="1.0" />
          <span id="tempVal" aria-hidden="true">1.0</span>
        </div>
      </div>

      <!-- √ºzenetek ‚Äì oldal n≈ë lefel√© -->
      <div class="messages" id="messages"></div>

      <!-- kompon√°l√≥ sor -->
      <div class="composer">
        <div class="field">
          <textarea id="prompt" placeholder="√çrj √ºzenetet‚Ä¶" rows="1"></textarea>
        </div>
        <button class="btn gold" id="sendBtn">K√ºld√©s</button>
      </div>
      <div class="hint">Enter = k√ºld√©s ¬∑ Shift+Enter = √∫j sor ¬∑ Szerkeszt√©s / T√∂rl√©s / M√°sol√°s az √ºzenet jobb fels≈ë sark√°ban</div>
    </section>

    <div class="spacer"></div>
  </main>

  <script>
    // ===== √ÅLLAPOT =====
    const STORE_KEY = 'tg_ai_chat_v2';
    const THEME_KEY = 'tg_ai_theme';
    let state = loadState();

    const $msgs = document.getElementById('messages');
    const $prompt = document.getElementById('prompt');
    const $send = document.getElementById('sendBtn');
    const $export = document.getElementById('exportBtn');
    const $import = document.getElementById('importFile');
    const $clear = document.getElementById('clearBtn');
    const $theme = document.getElementById('themeBtn');
    const $model = document.getElementById('model');
    const $temp = document.getElementById('temp');
    const $tempVal = document.getElementById('tempVal');

    // ===== THEME =====
    (function initTheme(){
      const saved = localStorage.getItem(THEME_KEY) || 'light';
      if(saved==='dark') document.documentElement.classList.add('dark');
      $theme.textContent = document.documentElement.classList.contains('dark') ? 'üåû' : 'üåô';
    })();
    $theme.addEventListener('click', ()=>{
      document.documentElement.classList.toggle('dark');
      const dark = document.documentElement.classList.contains('dark');
      localStorage.setItem(THEME_KEY, dark ? 'dark' : 'light');
      $theme.textContent = dark ? 'üåû' : 'üåô';
    });

    // ===== TEMP UI =====
    $temp.addEventListener('input', ()=>{ $tempVal.textContent = $temp.value; });

    // ===== AUTORESIZE =====
    function autoresize(){ $prompt.style.height = 'auto'; $prompt.style.height = Math.min($prompt.scrollHeight, 240) + 'px'; }
    $prompt.addEventListener('input', autoresize);
    autoresize();

    // ===== STORAGE =====
    function loadState(){
      try{
        const raw = localStorage.getItem(STORE_KEY);
        return raw ? JSON.parse(raw) : { messages: [] };
      }catch{ return { messages: [] } }
    }
    function saveState(){ localStorage.setItem(STORE_KEY, JSON.stringify(state)); }

    // ===== RENDER =====
    function fmtTime(d){
      const t = new Date(d);
      return t.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
    }
    function render(){
      $msgs.innerHTML = '';
      state.messages.forEach((m, i)=>{
        const el = document.createElement('div');
        el.className = 'msg ' + (m.role === 'user' ? 'user' : 'assistant');
        el.innerHTML = `
          <div class="content" contenteditable="false">${escapeHtml(m.content).replace(/\n/g,'<br>')}</div>
          <div class="meta">${m.role === 'assistant' ? 'AI' : 'Te'} ‚Ä¢ ${fmtTime(m.time)}</div>
          <div class="actions">
            <button class="icon-btn" data-act="copy" title="M√°sol√°s" data-idx="${i}">üìã</button>
            <button class="icon-btn" data-act="edit" title="Szerkeszt√©s" data-idx="${i}">‚úèÔ∏è</button>
            <button class="icon-btn" data-act="del"  title="T√∂rl√©s" data-idx="${i}">üóëÔ∏è</button>
          </div>
        `;
        $msgs.appendChild(el);
      });
    }
    function escapeHtml(s){ return s.replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m])); }

    // ===== ACTIONS ON MESSAGES =====
    $msgs.addEventListener('click', (e)=>{
      const btn = e.target.closest('.icon-btn'); if(!btn) return;
      const i = +btn.dataset.idx;
      const act = btn.dataset.act;
      if(Number.isNaN(i) || !state.messages[i]) return;

      if(act==='copy'){
        navigator.clipboard.writeText(state.messages[i].content);
      }else if(act==='del'){
        state.messages.splice(i,1); saveState(); render();
      }else if(act==='edit'){
        const node = $msgs.children[i].querySelector('.content');
        const editing = node.getAttribute('contenteditable') === 'true';
        if(!editing){
          node.setAttribute('contenteditable','true'); node.focus();
        }else{
          node.setAttribute('contenteditable','false');
          state.messages[i].content = node.innerText; state.messages[i].time = Date.now(); saveState(); render();
        }
      }
    });

    // ===== SEND (csak felveszi az √ºzenetet; API-t k√©s≈ëbb k√∂tj√ºk) =====
    function send(){
      const text = $prompt.value.trim();
      if(!text) return;
      state.messages.push({ role:'user', content:text, time: Date.now() });
      $prompt.value=''; autoresize();
      saveState(); render();

      // IDE j√∂n majd az API h√≠v√°s:
      // sendToAPI({ model: $model.value, temperature: +$temp.value, messages: state.messages })
      //   .then(aiText => { state.messages.push({ role:'assistant', content: aiText, time: Date.now() }); saveState(); render(); });
    }
    $send.addEventListener('click', send);
    $prompt.addEventListener('keydown', (e)=>{
      if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); send(); }
    });

    // ===== EXPORT .txt =====
    function exportTxt(){
      const lines = state.messages.map(m => `${m.role.toUpperCase()} [${new Date(m.time).toISOString()}]\n${m.content}\n`);
      const blob = new Blob([lines.join('\n')], {type:'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'tg-ai-chat.txt'; a.click();
      URL.revokeObjectURL(url);
    }
    $export.addEventListener('click', exportTxt);

    // ===== IMPORT .json =====
    $import.addEventListener('change', async (e)=>{
      const file = e.target.files?.[0]; if(!file) return;
      const text = await file.text();
      try{
        const data = JSON.parse(text);
        if(Array.isArray(data.messages)) { state.messages = data.messages; saveState(); render(); }
      }catch{}
      e.target.value = '';
    });

    // ===== CLEAR =====
    $clear.addEventListener('click', ()=>{
      if(confirm('Biztos t√∂rl√∂d az eg√©sz besz√©lget√©st?')){ state.messages = []; saveState(); render(); }
    });

    // els≈ë render
    render();
  </script>
</body>
</html>
