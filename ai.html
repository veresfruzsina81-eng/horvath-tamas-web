<!doctype html>
<html lang="hu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TamasGem Studio ‚Äî AI</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#fff;
      --card:#fff;
      --text:#0b0b0c;
      --muted:#5f646b;
      --border:#ececec;
      --gold:#D4AF37;
      --shadow: 0 10px 28px rgba(212,175,55,.08), 0 6px 16px rgba(0,0,0,.04);
    }
    .dark{
      --bg:#0b0c0f;
      --card:#111319;
      --text:#eaeef6;
      --muted:#9aa3ad;
      --border:#1e232b;
      --shadow: 0 10px 28px rgba(0,0,0,.6), 0 6px 16px rgba(0,0,0,.4);
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:var(--bg);color:var(--text)}
    a{text-decoration:none;color:inherit}

    /* Fejl√©c */
    header{
      position:sticky;top:0;z-index:10;
      background:linear-gradient(#fffef6,var(--bg));
      border-bottom:1px solid var(--border);
      backdrop-filter:saturate(140%) blur(6px);
    }
    .dark header{background:linear-gradient(#0c0d12,var(--bg))}
    .container{max-width:980px;margin:0 auto;padding:14px 16px;display:flex;align-items:center;gap:12px;justify-content:space-between}
    .brand{display:flex;align-items:center;gap:10px}
    .brand img{height:28px;width:auto;filter:drop-shadow(0 0 6px rgba(212,175,55,.35))}
    .top-actions{display:flex;align-items:center;gap:10px}
    .btn{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 12px;border-radius:12px;border:1px solid var(--border);
      background:var(--card);color:var(--text);font-weight:600;font-size:13px;
      box-shadow:var(--shadow);cursor:pointer;transition:.2s ease;
    }
    .btn:hover{transform:translateY(-1px)}
    .btn.gold{
      border-color:rgba(212,175,55,.35);
      background:linear-gradient(90deg,#fff7d4,#f3e1a1);color:#7a5b0e;
    }
    #importFile{display:none}

    /* FIX magass√°g√∫ chat doboz a f≈ër√©szben */
    main{max-width:980px;margin:18px auto;padding:0 16px}
    .chat{
      background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow);
      display:flex;flex-direction:column;overflow:hidden;
      /* Fix magass√°g: az eg√©sz panel ~80vh, NEM ny√∫lik lejjebb */
      height: min(80vh, 900px);
    }

    /* Fels≈ë eszk√∂zt√°r (a chat dobozon bel√ºl) */
    .toolbar{display:flex;flex-wrap:wrap;gap:10px;align-items:center;padding:12px;border-bottom:1px solid var(--border);background:var(--bg)}
    .group{display:flex;align-items:center;gap:8px;padding:8px;border:1px solid var(--border);border-radius:12px;background:var(--card)}
    label{font-size:12px;color:var(--muted)}
    select, input[type="range"]{
      appearance:none;border:1px solid var(--border);background:var(--bg);color:var(--text);
      padding:6px 8px;border-radius:8px;outline:none;font-size:13px;
    }
    input[type="range"]{width:140px}

    /* √úzenetek ‚Äì SAJ√ÅT SCROLL a fix dobozon bel√ºl */
    .messages{
      flex:1; /* kit√∂lti a fix panel k√∂z√©ps≈ë r√©sz√©t */
      overflow:auto;
      padding:16px;
      display:flex;flex-direction:column;gap:12px;
      background:
        radial-gradient(80rem 30rem at 10% -10%, rgba(212,175,55,.08), transparent),
        radial-gradient(80rem 30rem at 90% -10%, rgba(212,175,55,.06), transparent);
    }
    .msg{
      max-width:78%;padding:12px 14px;border:1px solid var(--border);border-radius:14px;line-height:1.5;background:var(--bg);
      position:relative;
    }
    .msg.assistant{align-self:flex-start;background:linear-gradient(180deg,#fffef8,var(--bg));border-color:#f1e6bf}
    .dark .msg.assistant{background:linear-gradient(180deg,#14161c,var(--bg));border-color:#2a2f39}
    .msg.user{align-self:flex-end}
    .meta{margin-top:6px;font-size:11px;color:var(--muted)}
    .actions{
      position:absolute;top:8px;right:8px;display:flex;gap:6px;opacity:.0;transition:.2s;pointer-events:none;
    }
    .msg:hover .actions{opacity:1;pointer-events:auto}
    .icon-btn{
      width:28px;height:28px;border-radius:8px;border:1px solid var(--border);background:var(--card);
      display:inline-flex;align-items:center;justify-content:center;cursor:pointer;font-size:12px;
    }

    /* Kompon√°l√≥ sor (alul) */
    .composer{display:flex;gap:10px;align-items:flex-end;padding:12px;border-top:1px solid var(--border);background:var(--bg)}
    .field{
      flex:1;display:flex;align-items:flex-end;gap:8px;border:1px solid var(--border);border-radius:14px;background:var(--card);padding:10px 12px;
    }
    textarea{
      flex:1;border:0;outline:0;background:transparent;color:var(--text);resize:none;min-height:44px;max-height:240px;font-size:15px;line-height:1.5;
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <a class="brand" href="index.html" title="Vissza">
        <img src="logo.png" alt="TamasGem Studio" />
        <strong>TamasGem Studio ‚Äî AI</strong>
      </a>
      <div class="top-actions">
        <button class="btn" id="themeBtn" title="Dark / Light m√≥d v√°lt√°s">üåô</button>
        <button class="btn" id="exportBtn" title="Export .txt">‚¨áÔ∏è Export</button>
        <label class="btn" for="importFile" title="Import .json">‚¨ÜÔ∏è Import</label>
        <input id="importFile" type="file" accept="application/json" />
        <button class="btn" id="clearBtn" title="T√∂rl√©s (chat √ºr√≠t√©se)">üóëÔ∏è Clear</button>
      </div>
    </div>
  </header>

  <main>
    <section class="chat" id="chat">
      <!-- Eszk√∂zt√°r (csak UI ‚Äì API-t k√©s≈ëbb k√∂tj√ºk) -->
      <div class="toolbar">
        <div class="group">
          <label for="model">Model</label>
          <select id="model">
            <option value="gpt-5">GPT-5</option>
            <option value="gpt-4.1">GPT-4.1</option>
            <option value="claude">Claude</option>
          </select>
        </div>
        <div class="group">
          <label for="temp">Temperature</label>
          <input id="temp" type="range" min="0" max="2" step="0.1" value="1.0" />
          <span id="tempVal" aria-hidden="true">1.0</span>
        </div>
      </div>

      <!-- √úzenetlista ‚Äì FIX panelben saj√°t scroll -->
      <div class="messages" id="messages"></div>

      <!-- Kompon√°l√≥ -->
      <div class="composer">
        <div class="field">
          <textarea id="prompt" placeholder="√çrj √ºzenetet‚Ä¶" rows="1"></textarea>
        </div>
        <button class="btn gold" id="sendBtn">K√ºld√©s</button>
      </div>
    </section>
  </main>

  <script>
    /* ===== √Ållapot ===== */
    var STORE_KEY = 'tg_ai_chat_v2';
    var THEME_KEY = 'tg_ai_theme';
    var state = loadState();

    var msgs = document.getElementById('messages');
    var promptEl = document.getElementById('prompt');
    var sendBtn = document.getElementById('sendBtn');
    var exportBtn = document.getElementById('exportBtn');
    var importFile = document.getElementById('importFile');
    var clearBtn = document.getElementById('clearBtn');
    var themeBtn = document.getElementById('themeBtn');
    var modelEl = document.getElementById('model');
    var tempEl = document.getElementById('temp');
    var tempVal = document.getElementById('tempVal');

    /* ===== T√©ma ===== */
    (function initTheme(){
      var saved = localStorage.getItem(THEME_KEY) || 'light';
      if(saved==='dark'){ document.documentElement.classList.add('dark'); themeBtn.textContent='üåû'; }
      else { themeBtn.textContent='üåô'; }
    })();
    themeBtn.addEventListener('click', function(){
      var isDark = document.documentElement.classList.toggle('dark');
      localStorage.setItem(THEME_KEY, isDark ? 'dark' : 'light');
      themeBtn.textContent = isDark ? 'üåû' : 'üåô';
    });

    /* ===== Temp UI ===== */
    tempEl.addEventListener('input', function(){ tempVal.textContent = tempEl.value; });

    /* ===== Autoresize textarea ===== */
    function autoresize(){
      promptEl.style.height = 'auto';
      var h = promptEl.scrollHeight;
      if(h > 240) h = 240;
      promptEl.style.height = h + 'px';
    }
    promptEl.addEventListener('input', autoresize);
    autoresize();

    /* ===== Storage ===== */
    function loadState(){
      try{
        var raw = localStorage.getItem(STORE_KEY);
        return raw ? JSON.parse(raw) : { messages: [] };
      }catch(e){ return { messages: [] }; }
    }
    function saveState(){ localStorage.setItem(STORE_KEY, JSON.stringify(state)); }

    /* ===== Render ===== */
    function fmtTime(ts){
      var t = new Date(ts);
      return t.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
    }
    function escapeHtml(s){ return s.replace(/[&<>"']/g, function(m){ return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]); }); }
    function render(){
      msgs.innerHTML = '';
      for(var i=0;i<state.messages.length;i++){
        var m = state.messages[i];
        var el = document.createElement('div');
        el.className = 'msg ' + (m.role === 'user' ? 'user' : 'assistant');
        el.innerHTML =
          '<div class="content" contenteditable="false">' + escapeHtml(m.content).replace(/\n/g,'<br>') + '</div>' +
          '<div class="meta">' + (m.role==='assistant'?'AI':'Te') + ' ‚Ä¢ ' + fmtTime(m.time) + '</div>' +
          '<div class="actions">' +
            '<button class="icon-btn" data-act="copy" title="M√°sol√°s" data-idx="'+i+'">üìã</button>' +
            '<button class="icon-btn" data-act="edit" title="Szerkeszt√©s" data-idx="'+i+'">‚úèÔ∏è</button>' +
            '<button class="icon-btn" data-act="del"  title="T√∂rl√©s" data-idx="'+i+'">üóëÔ∏è</button>' +
          '</div>';
        msgs.appendChild(el);
      }
      msgs.scrollTop = msgs.scrollHeight;
    }

    /* ===== √úzenet akci√≥k ===== */
    msgs.addEventListener('click', function(e){
      var btn = e.target.closest ? e.target.closest('.icon-btn') : null;
      if(!btn) return;
      var i = +btn.getAttribute('data-idx');
      var act = btn.getAttribute('data-act');
      if(isNaN(i) || !state.messages[i]) return;

      if(act==='copy'){
        if(navigator.clipboard && navigator.clipboard.writeText){
          navigator.clipboard.writeText(state.messages[i].content);
        }
      }else if(act==='del'){
        state.messages.splice(i,1); saveState(); render();
      }else if(act==='edit'){
        var node = msgs.children[i].querySelector('.content');
        var editing = node.getAttribute('contenteditable') === 'true';
        if(!editing){
          node.setAttribute('contenteditable','true'); node.focus();
        }else{
          node.setAttribute('contenteditable','false');
          state.messages[i].content = node.innerText;
          state.messages[i].time = Date.now();
          saveState(); render();
        }
      }
    });

    /* ===== K√ºld√©s (k√©s≈ëbb itt h√≠vjuk az API-t) ===== */
    function send(){
      var text = promptEl.value.trim();
      if(!text) return;
      state.messages.push({ role:'user', content:text, time: Date.now() });
      promptEl.value=''; autoresize();
      saveState(); render();

      // Itt lesz az API:
      // sendToAPI({ model: modelEl.value, temperature: +tempEl.value, messages: state.messages })
      //   .then(function(aiText){
      //     state.messages.push({ role:'assistant', content: aiText, time: Date.now() });
      //     saveState(); render();
      //   });
    }
    sendBtn.addEventListener('click', send);
    promptEl.addEventListener('keydown', function(e){
      if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); send(); }
    });

    /* ===== Export / Import / Clear ===== */
    function exportTxt(){
      var lines = state.messages.map(function(m){
        return (m.role.toUpperCase() + ' [' + new Date(m.time).toISOString() + ']\n' + m.content + '\n');
      });
      var blob = new Blob([lines.join('\n')], {type:'text/plain'});
      var url = URL.createObjectURL(blob);
      var a = document.createElement('a');
      a.href = url; a.download = 'tg-ai-chat.txt'; a.click();
      URL.revokeObjectURL(url);
    }
    exportBtn.addEventListener('click', exportTxt);

    importFile.addEventListener('change', function(e){
      var file = e.target.files && e.target.files[0]; if(!file) return;
      var reader = new FileReader();
      reader.onload = function(){
        try{
          var data = JSON.parse(reader.result);
          if(data && Array.isArray(data.messages)){
            state.messages = data.messages;
            saveState(); render();
          }
        }catch(err){}
        importFile.value='';
      };
      reader.readAsText(file);
    });

    clearBtn.addEventListener('click', function(){
      if(confirm('Biztos t√∂rl√∂d az eg√©sz besz√©lget√©st?')){
        state.messages = []; saveState(); render();
      }
    });

    /* ===== Init render ===== */
    render();
  </script>
</body>
</html>
